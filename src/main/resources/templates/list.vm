#*
 * Copyright (C) 2011 Everit Kft. (http://www.everit.org)
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *#
$webResourceManager.requireResource("jira.webresources:dwr", null)   
$webResourceManager.requireResource("jira.webresources:ajax-preview", null)
#set($rowCount = 0)
<div class="results-wrap">
	<div>
	    <table class="grid" border="0" cellpadding="2" cellspacing="0" width="100%">
	              <thead>
	                   <tr class="rowHeader">
	                       <td width="10%" class="center-text" title="$i18n.getText('jttp.list.title.issue')">
	                           Issue
	                        </td>
	                        <td class="label-row">
	                           $i18n.getText("plugin.start")
	                        </td>
	                        <td class="label-row">
	                           $i18n.getText("plugin.end")
	                        </td>
	                        <td class="label-row"> 
	                          $i18n.getText("plugin.duration")
	                        </td>
	                        <td class="label-row"> 
	                          $i18n.getText("plugin.remaining")
	                        </td>
	                        <td width="60%">
	                          $i18n.getText("plugin.note")
	                        </td>
	                        <td width="10%" class="center-text" title="$i18n.getText('jttp.list.title.actions')">
	                          $i18n.getText("plugin.actions")
	                        </td>
	                    </tr>
                    </thead>
                    #if($worklogs.size() == 0)
            			</table>
            			<div id="message" style="center-text padding: 3px; font-size: 14px;">
				 			$i18n.getText("plugin.no.worklogs")
					  	</div>
                    #else
                    	<tbody id="issueTable">
		                   	#foreach ($worklog in $worklogs)
		                    	<tr #if($worklog.worklogId == $editedWorklogId) class="rowEdit" #end #if($rowCount % 2 != 0) class="rowAlter" #end>
		                    	 	<td class="table-issue" class="vertically-middle">
		                    	 		<a href="/browse/$worklog.issue" class="issue-link" title="#if($worklog.issueParent != '') $i18n.getText('plugin.parent.issue') $worklog.issueParent &#13 $worklog.issueSummary #else $worklog.issueSummary #end">$worklog.issue</a>
		                    	 	</td>
		                    	 	<td class="table-starttime" class="vertically-middle">
		                    	 		$worklog.startTime
		                    	 	</td>
		                    	 	<td class="table-endtime" class="vertically-middle">
		                    	 		$worklog.endTime
		                    	 	</td>
		                    	 	<td class="vertically-middle">
		                    	 		$worklog.duration
		                    	 	</td>
									<td class="vertically-middle">
		                    	 		#if(!$worklog.isMoreEstimatedTime)
		                    	 			<div style="color:red;">$worklog.remaining</div>
										#else
											$worklog.remaining
										#end
		                    	 		
		                    	 	</td>
		                    	 	<td id="commentRow_$rowCount" name="commentRow_$rowCount" class="table-comment wiki-edit-content" class="vertically-middle">
		                    	 		<input id="hiddenWorklogBody" type="hidden" value="$worklog.body">
		                    	 	</td>
		                    	 	<script>
				                    	 		jQuery.ajax({
				                    	 			url:  "${req.contextPath}/rest/api/1.0/render",
	                								contentType: "application/json",
	                								type:'POST',
	                								data: JSON.stringify({
	                    								rendererType: "atlassian-wiki-renderer",
	                    								unrenderedMarkup: "$worklog.body"
	                								}),
	                								dataType: "text",
	                								success: function(data){
	                								data = data.replace('<p>','');
	                								data = data.replace('</p>','');
			                    	 				AJS.$("#commentRow_$rowCount").append(data);
			                    	 				AJS.$("#commentRow_$rowCount").attr("class","vertically-middle");
			                    	 			}
	            								}); 
	            					</script>
		                    	 	<td class="vertically-middle center-text>
		                    	 		<input id="hiddenWorklogId" type="hidden" value="$worklog.worklogId" >
		                    	 		<span class="aui-icon aui-icon-small aui-iconfont-edit jttp-aui-icon"
		                    	 			id="edit" name="edit" title="$i18n.getText('plugin.edit')"
		                    	 			onclick="location.href='JiraTimetrackerWebAction.jspa?editedWorklogId=$worklog.worklogId&dateFormatted=$dateFormatted'"></span>
		                    	 		<span class="aui-icon aui-icon-small aui-iconfont-delete jttp-aui-icon"
		                    	 			id="delete" name="delete" title="$i18n.getText('plugin.delete')"
		                    	 			onclick="location.href='JiraTimetrackerWebAction!default.jspa?deletedWorklogId=$worklog.worklogId&dateFormatted=$dateFormatted'"></span>
		                    	 		<span class="aui-icon aui-icon-small aui-iconfont-copy-clipboard copy jttp-aui-icon"
		                    	 			id="copy" name="copy" title="$i18n.getText('plugin.copy')"></span>
		                    	 	</td>
		                    	</tr>
		                    	#set($rowCount = $rowCount + 1)
		                    #end
		                </tbody>
		            </table>
		            #end
		        </div>
		    </div>