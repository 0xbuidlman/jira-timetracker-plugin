#*
 * Copyright (C) 2011 Everit Kft. (http://www.everit.org)
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *#
                <div id="detailsModule" class="module toggle-wrap expanded">
                    <div id="detailsModuleHeading" class="mod-header">
                        <span class="aui-icon aui-icon-small aui-iconfont-expanded"></span>
                        <h2 class="toggle-title"  onclick="everit.reporting.main.toggleModContent('details')">Work Log Details</h2>
                    </div>
                    <div class="mod-content">
                        <div class="aui-group aui-group-split action-button-container">
                            <div class="aui-item">
                                <button class="aui-button aui-button-subtle aui-dropdown2-trigger" id="details-groupby">Group by</button>                        
                            </div>
                            <div class="aui-item">
                                <a id="detailsColumnsButton" href="#detailsColumnsDropDown" aria-owns="detailsColumnsDropDown" aria-haspopup="true" class="criteria-selector aui-button aui-button-subtle drop-arrow aui-dropdown2-trigger">Columns</a>
	                            <div id="detailsColumnsDropDown" class="aui-style-default aui-dropdown2">
	                              <div class="jttr-filter-field">
	                                <div class='ajs-layer box-shadow'>
	                                  <div>
	                                    <div class='form-body'>
	                                      <div class='field-group aui-field-issuetype'>
	                                        <select  id="detailsColumns" name="detailsColumns"  multiple="multiple" >
	                                          <option value="jtrp_col_projectDescription">Project Description</option>
	                                          <option value="jtrp_col_type">Type</option>
	                                          <option value="jtrp_col_status">Status</option>
	                                          <option value="jtrp_col_priority">Priority</option>                                        
	                                          <option value="jtrp_col_assignee">Assignee</option>
	                                          <option value="jtrp_col_reporter">Reporter</option>
	                                          <option value="jtrp_col_estimated">Estimated</option>
	                                          <option value="jtrp_col_remainingTime">Remaining</option>
	                                          <option value="jtrp_col_created">Created</option>
	                                          <option value="jtrp_col_updated">Updated</option>
	                                          <option value="jtrp_col_components">Component/s</option>
	                                          <option value="jtrp_col_affectedVersions">Affected version/s</option>
	                                          <option value="jtrp_col_fixVersions">Fix version/s</option>
	                                          <option value="jtrp_col_resolution">Resolution</option>
	                                          <option value="jtrp_col_worklogDescription">Work Description</option>
	                                          <option value="jtrp_col_user">User</option>
	                                          <option value="jtrp_col_startTime">Start time</option>
	                                          <option value="jtrp_col_worklogCreated">Worklog Created</option>
	                                          <option value="jtrp_col_worklogUpdated">Worklog Updated</option>
	                                        </select>
	                                      </div>
	                                    </div>
	                                  </div>
	                                </div>
	                              </div>
	                            </div>
                                <a id="worklogDetailsExportButton" href="#worklogDetailsExportDropDown" aria-owns="worklogDetailsExportDropDown" aria-haspopup="true" class="criteria-selector aui-button aui-button-subtle drop-arrow aui-dropdown2-trigger">
                                  <span class="aui-icon aui-icon-small aui-iconfont-export"></span>
                                  <span class="button-label">Export</span>
                                </a>
	                            <div id="worklogDetailsExportDropDown" class="aui-style-default aui-dropdown2">
	                              <div class="jttr-filter-field">
	                                <div class='ajs-layer box-shadow'>
	                                  <div data-query>
	                                    <div class='form-body checkboxmultiselect-container'>
	                                      <div class='field-group aui-field-issuetype'>
	                                        <ul class="aui-list-section">
	                                          <li class="aui-list-item">
	                                            <a id="detials-all-export" class="aui-list-item-link" target="_blank" href="#" data-jttp-href="$contextPath/rest/jttp-rest/1/download-report/downloadWorklogDetailsReport" onclick="everit.reporting.main.updateDetailsAllExportHref()">Export all</a>
	                                          </li>
	                                          <li class="aui-list-item">
	                                            <a id="detials-custom-export" class="aui-list-item-link" target="_blank" href="#" data-jttp-href="$contextPath/rest/jttp-rest/1/download-report/downloadWorklogDetailsReport" onclick="everit.reporting.main.updateDetailsCustomExportHref()">Export custom</a>
	                                          </li>
	                                        </ul>
	                                      </div>
	                                    </div>
	                                  </div>
	                                </div>
	                              </div>
	                            </div>
                            </div>
                        </div>
                        <div class="details-tale-container">
                            <table class="aui reporting-table">
                                #set($isNotShowProjectDescription = !$selectedWorklogDetailsColumns.contains("jtrp_col_projectDescription"))
                                #set($isNotShowType = !$selectedWorklogDetailsColumns.contains("jtrp_col_type"))
                                #set($isNotShowStatus = !$selectedWorklogDetailsColumns.contains("jtrp_col_status"))
                                #set($isNotShowPriority = !$selectedWorklogDetailsColumns.contains("jtrp_col_priority"))
                                #set($isNotShowAssignee = !$selectedWorklogDetailsColumns.contains("jtrp_col_assignee"))
                                #set($isNotShowReporter = !$selectedWorklogDetailsColumns.contains("jtrp_col_reporter"))
                                #set($isNotShowEstimated = !$selectedWorklogDetailsColumns.contains("jtrp_col_estimated"))
                                #set($isNotShowRemainingTime = !$selectedWorklogDetailsColumns.contains("jtrp_col_remainingTime"))
                                #set($isNotShowCreated = !$selectedWorklogDetailsColumns.contains("jtrp_col_created"))
                                #set($isNotShowUpdated = !$selectedWorklogDetailsColumns.contains("jtrp_col_updated"))
                                #set($isNotShowComponents = !$selectedWorklogDetailsColumns.contains("jtrp_col_components"))
                                #set($isNotShowAffectedVersions = !$selectedWorklogDetailsColumns.contains("jtrp_col_affectedVersions"))
                                #set($isNotShowFixVersions = !$selectedWorklogDetailsColumns.contains("jtrp_col_fixVersions"))
                                #set($isNotShowResolution = !$selectedWorklogDetailsColumns.contains("jtrp_col_resolution"))
                                #set($isNotShowWorklogDescription = !$selectedWorklogDetailsColumns.contains("jtrp_col_worklogDescription"))
                                #set($isNotShowUser = !$selectedWorklogDetailsColumns.contains("jtrp_col_user"))
                                #set($isNotShowStartTime = !$selectedWorklogDetailsColumns.contains("jtrp_col_startTime"))
                                #set($isNotShowWorklogCreated = !$selectedWorklogDetailsColumns.contains("jtrp_col_worklogCreated"))
                                #set($isNotShowWorklogUpdated = !$selectedWorklogDetailsColumns.contains("jtrp_col_worklogUpdated"))
                                <thead>
                                    <tr>
                                        <th class="jtrp_col_project">Project</th>
                                        <th class="jtrp_col_projectDescription" style="#if( $isNotShowProjectDescription )display:none;#end">Project Description</th>
                                        <th class="jtrp_col_issueKey">Issue Key</th>
                                        <th class="jtrp_col_issueSummary">Issue Summary</th>
                                        <th class="jtrp_col_type" style="#if( $isNotShowType )display:none;#end">Type</th>
                                        <th class="jtrp_col_status" style="#if( $isNotShowStatus )display:none;#end">Status</th>
                                        <th class="jtrp_col_priority" style="#if( $isNotShowPriority )display:none;#end">Priority</th>                                        
                                        <th class="jtrp_col_assignee" style="#if( $isNotShowAssignee )display:none;#end">Assignee</th>
                                        <th class="jtrp_col_reporter" style="#if( $isNotShowReporter )display:none;#end">Reporter</th>
                                        <th class="jtrp_col_estimated" style="#if( $isNotShowEstimated )display:none;#end">Estimated</th>
                                        <th class="jtrp_col_remainingTime" style="#if( $isNotShowRemainingTime )display:none;#end">Remaining</th>
                                        <th class="jtrp_col_created" style="#if( $isNotShowCreated )display:none;#end">Created</th>
                                        <th class="jtrp_col_updated" style="#if( $isNotShowUpdated )display:none;#end">Updated</th>
                                        <th class="jtrp_col_components" style="#if( $isNotShowComponents )display:none;#end">Component/s</th>
                                        <th class="jtrp_col_affectedVersions" style="#if( $isNotShowAffectedVersions )display:none;#end">Affected version/s</th>
                                        <th class="jtrp_col_fixVersions" style="#if( $isNotShowFixVersions )display:none;#end">Fix version/s</th>
                                        <th class="jtrp_col_resolution" style="#if( $isNotShowResolution )display:none;#end">Resolution</th>
                                        <th class="jtrp_col_worklogDescription" style="#if( $isNotShowWorklogDescription )display:none;#end">Work Description</th>
                                        <th class="jtrp_col_user" style="#if( $isNotShowUser )display:none;#end">User</th>
                                        <th class="jtrp_col_startTime" style="#if( $isNotShowStartTime )display:none;#end">Start time</th>
                                        <th class="jtrp_col_timeSpent">Time Spent</th>
                                        <th class="jtrp_col_worklogCreated" style="#if( $isNotShowWorklogCreated )display:none;#end">Worklog Created</th>
                                        <th class="jtrp_col_worklogUpdated" style="#if( $isNotShowWorklogUpdated )display:none;#end">Worklog Updated</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    #foreach ( $wd in $worklogDetailsReport.worklogDetails )
                                    <tr>
                                        <td class="jtrp_col_project">$wd.projectName</td>
                                        <td class="jtrp_col_projectDescription" style="#if( $isNotShowProjectDescription )display:none;#end">#if ( $wd.projectDescription ) $wd.projectDescription #end</td>
                                        <td class="jtrp_col_issueKey">$wd.issueKey</td>
                                        <td class="jtrp_col_issueSummary">$wd.issueSummary</td>
                                        <td class="jtrp_col_type" style="#if( $isNotShowType )display:none;#end">$wd.issueTypeName</td>
                                        <td class="jtrp_col_status" style="#if( $isNotShowStatus )display:none;#end">$wd.issueStatusName</td>
                                        <td class="jtrp_col_priority" style="#if( $isNotShowPriority )display:none;#end">$wd.priorityName</td>
                                        <td class="jtrp_col_assignee" style="#if( $isNotShowAssignee )display:none;#end">#if ( !$wd.issueAssignee ) Unassigneed #else $wd.issueAssignee #end</td>
                                        <td class="jtrp_col_reporter" style="#if( $isNotShowReporter )display:none;#end">$wd.issueReporter</td>
                                        <td class="jtrp_col_estimated" style="#if( $isNotShowEstimated )display:none;#end">#if ( !$wd.issueOriginalEstimate ) #else $durationFormatter.exactDuration($wd.issueOriginalEstimate) #end</td>
                                        <td class="jtrp_col_remainingTime" style="#if( $isNotShowRemainingTime )display:none;#end">#if ( !$wd.issueRemainingEstimate ) #else $durationFormatter.exactDuration($wd.issueRemainingEstimate) #end</td>
                                        <td class="jtrp_col_created" style="#if( $isNotShowCreated )display:none;#end">$outlookDate.formatDMY($wd.issueCreated)</td>
                                        <td class="jtrp_col_updated" style="#if( $isNotShowUpdated )display:none;#end">$outlookDate.formatDMY($wd.issueUpdated)</td>
                                        <td class="jtrp_col_components" style="#if( $isNotShowComponents )display:none;#end">#if ( !$wd.issueComponents.isEmpty() ) #foreach ( $component in $wd.issueComponents )#if($velocityCount> 1),#end $component#end #end</td>
                                        <td class="jtrp_col_affectedVersions" style="#if( $isNotShowAffectedVersions )display:none;#end">#if ( !$wd.issueAffectedVersions.isEmpty() ) #foreach ( $affectedVersion in $wd.issueAffectedVersions )#if($velocityCount> 1),#end $affectedVersion #end #end</td>
                                        <td class="jtrp_col_fixVersions" style="#if( $isNotShowFixVersions )display:none;#end">#if ( !$wd.issueFixedVersions.isEmpty() ) #foreach ( $fixedVersion in $wd.issueFixedVersions )#if($velocityCount> 1),#end $fixedVersion #end #end</td>
                                        <td class="jtrp_col_resolution" style="#if( $isNotShowResolution )display:none;#end">#if ( !$wd.resolutionName ) Unresolved #else $wd.resolutionName #end</td>
                                        <td class="jtrp_col_worklogDescription" style="#if( $isNotShowWorklogDescription )display:none;#end">$wd.worklogBody</td>
                                        <td class="jtrp_col_user" style="#if( $isNotShowUser )display:none;#end">$wd.worklogUser</td>
                                        <td class="jtrp_col_startTime" style="#if( $isNotShowStartTime )display:none;#end">$outlookDate.formatDMYHMS($wd.worklogStartDate)</td>
                                        <td class="jtrp_col_timeSpent">$durationFormatter.exactDuration($wd.worklogTimeWorked)</td>
                                        <td class="jtrp_col_worklogCreated" style="#if( $isNotShowWorklogCreated )display:none;#end">$outlookDate.formatDMY($wd.worklogCreated)</td>
                                        <td class="jtrp_col_worklogUpdated" style="#if( $isNotShowWorklogUpdated )display:none;#end">$outlookDate.formatDMY($wd.worklogUpdated)</td>
                                    </tr>
                                    #end
                                </tbody>
                            </table>
                        </div>
                        <div class="aui-group aui-group-split count-pagination">
                            <div class="aui-item">
                                <span class="results-count-text">
                                    <span class="results-count results-count-start">$worklogDetailsReport.paging.start</span> –
                                    <span class="results-count results-count-end">$worklogDetailsReport.paging.end</span> of 
                                    <span class="results-count results-count-total results-count-link">$worklogDetailsReport.worklogDetailsCount</span>
                                </span>
                            </div>
                            <div class="aui-item">
                                <div class="pagination">
                                    #set($wdMaxPageNumber = $worklogDetailsReport.paging.maxPageNumber)
                                    
                                    #if ( $wdMaxPageNumber )
                                      #set($wdActPageNumber = $worklogDetailsReport.paging.actPageNumber)
                                      #set($filterLimit = $filterCondition.limit)
                                      #if ( $wdActPageNumber - 2 < 1 )
                                        #set($inStart = 1)
                                      #else
                                        #set($inStart = $wdActPageNumber - 2)
                                      #end
                                      #if ( $wdActPageNumber + 2 > $wdMaxPageNumber )
                                        #set($inEnd = $wdMaxPageNumber)
                                      #else
                                        #set($inEnd = $wdActPageNumber + 2)
                                      #end
                                      #if ( $wdActPageNumber < 3 )
                                        #if ($wdMaxPageNumber > 5) 
                                          #set($inEnd = 5) 
                                        #else 
                                          #set($inEnd = $wdMaxPageNumber) 
                                        #end
                                      #end
                                      #if ( $wdActPageNumber + 2 >= $wdMaxPageNumber && $wdMaxPageNumber - 4 > 0 ) 
                                        #set($inStart = $wdMaxPageNumber - 4)
                                      #end
                                    
                                      #if ( $wdActPageNumber > 1 )
                                    <a href="javascript:void(0);" onclick="everit.reporting.main.getWorklogDetailsPage((($wdActPageNumber - 1) * $filterLimit) - $filterLimit)">
                                        <span class="aui-icon aui-icon-small aui-iconfont-arrows-left"></span>
                                    </a>
                                      #end
                                      #foreach ( $page in [$inStart..$inEnd] ) 
                                        #if ( $wdActPageNumber == $page )
                                    <strong>$page</strong>
                                        #else
                                    <a href="javascript:void(0);" onclick="everit.reporting.main.getWorklogDetailsPage(($page * $filterLimit) - $filterLimit)">$page</a>
                                        #end
                                      #end
                                      #if ( $wdActPageNumber < $wdMaxPageNumber )
                                    <a href="javascript:void(0);" onclick="everit.reporting.main.getWorklogDetailsPage((($wdActPageNumber + 1) * $filterLimit) - $filterLimit)">
                                        <span class="aui-icon aui-icon-small aui-iconfont-arrows-right"></span>
                                    </a>
                                      #end
                                    #end
                                </div>
                            </div>
                        </div>
                    </div>            
                </div>